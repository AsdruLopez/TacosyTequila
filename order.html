<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Resumen del Pedido</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
    body{font-family:Montserrat,Arial;margin:18px;background:#fff7ed;color:#222}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.06);max-width:720px;margin:18px auto}
    h1{margin:0 0 12px}
    ul{padding:0;list-style:none}
    li{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}
    .actions{display:flex;gap:8px;margin-top:12px}
    .btn{background:#006847;color:#fff;padding:8px 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div class="card">
    <h1>Resumen del Pedido</h1>
    <div id="contenido">Cargando...</div>
    <div class="actions" id="acciones" style="display:none">
        <button id="confirmar" class="btn">Confirmar pedido</button>
        <button id="imprimir" class="btn" style="background:#CE1126">Imprimir</button>
    </div>
</div>

<script>
function decodificar(q){
    try {
        return JSON.parse(decodeURIComponent(atob(q)));
    } catch(e){
        return null;
    }
}

const params = new URLSearchParams(location.search);
const data = params.get('data');
const cont = document.getElementById('contenido');
if (!data) {
    cont.innerHTML = '<p>No se ha recibido ningún pedido.</p>';
} else {
    const carrito = decodificar(data);
    if (!carrito || !Array.isArray(carrito)) {
        cont.innerHTML = '<p>Datos del pedido inválidos.</p>';
    } else {
        let total = 0;
        const ul = document.createElement('ul');
        carrito.forEach(i => {
            const li = document.createElement('li');
            const sub = (i.precio * i.cantidad);
            total += sub;
            li.innerHTML = `<span><strong>${i.nombre}</strong> × ${i.cantidad}</span><span>${sub.toLocaleString('es-ES',{style:'currency',currency:'EUR'})}</span>`;
            ul.appendChild(li);
        });
        cont.innerHTML = '';
        cont.appendChild(ul);
        const t = document.createElement('p');
        t.style.textAlign='right';
        t.style.fontWeight='800';
        t.textContent = 'Total: ' + total.toLocaleString('es-ES',{style:'currency',currency:'EUR'});
        cont.appendChild(t);
        document.getElementById('acciones').style.display = 'flex';
    }
}

document.getElementById('imprimir').addEventListener('click', ()=> window.print());
document.getElementById('confirmar').addEventListener('click', ()=> {
    alert('Pedido confirmado (demo).');
    // aquí podrías enviar el pedido a tu backend o guardar en Google Sheets, etc.
});
</script>
</body>
</html>